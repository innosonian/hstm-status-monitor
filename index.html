<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Status Page</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <h1>Status Page</h1>
    <p>Last Updated: <span id="last-updated">Loading...</span></p>
  </header>
  
  <div class="content">
    <!-- Service History Section -->
    <div class="section">
      <h2>Service History</h2>
      <ul id="service-history">
        <li>Loading...</li>
      </ul>
    </div>

    <!-- List of Events -->
    <div class="section">
      <h2>List of Events</h2>
      <table>
        <thead>
          <tr>
            <th>Event</th>
            <th>Start Time</th>
            <th>Last Update Time</th>
          </tr>
        </thead>
        <tbody id="event-list">
          <tr><td colspan="3">Loading...</td></tr>
        </tbody>
      </table>
    </div>

    <!-- Event Details -->
    <div id="event-details" class="section hidden">
      <h2>Event Details</h2>
      <p><strong>Status:</strong> <span id="event-status">Loading...</span></p>
      <p><strong>Event Name:</strong> <span id="event-name">Loading...</span></p>
      <p><strong>Start Time:</strong> <span id="event-start">Loading...</span></p>
      <p><strong>Last Update Time:</strong> <span id="event-last-update">Loading...</span></p>
      <p><strong>Service:</strong> <span id="event-service">Loading...</span></p>
      <h3>Description</h3>
      <div class="timeline" id="event-description">
        <div class="timeline-item">
          <p>Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Mock API endpoints
    const base_url = 'http://localhost:8000'
    const API_ENDPOINTS = {
      serviceHistory: '/api/scorm/api/service-history',
      eventList: '/api/scorm/api/event-list',
      eventDetails: (eventId) => `/api/scorm/api/event-details/${eventId}`
    };

    // Fetch Service History
    async function fetchServiceHistory() {
      const response = await fetch(base_url + API_ENDPOINTS.serviceHistory);
      const data = await response.json();
      const serviceHistoryElement = document.getElementById('service-history');
      serviceHistoryElement.innerHTML = '';
      data.history.forEach((item) => {
        const listItem = document.createElement('li');
        listItem.textContent = `${item.date}: ${item.status}`;
        serviceHistoryElement.appendChild(listItem);
      });
    }

    // Fetch Event List
    async function fetchEventList() {
      const response = await fetch(base_url + API_ENDPOINTS.eventList);
      const data = await response.json();
      const eventListElement = document.getElementById('event-list');
      eventListElement.innerHTML = '';
      data.events.forEach((event) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${event.name}</td>
          <td>${event.startTime}</td>
          <td>${event.lastUpdateTime}</td>
        `;
        row.addEventListener('click', () => fetchEventDetails(event.id));
        eventListElement.appendChild(row);
      });
    }

    // Fetch Event Details
    async function fetchEventDetails(eventId) {
      const response = await fetch(base_url + API_ENDPOINTS.eventDetails(eventId));
      const data = await response.json();
      const eventDetailsSection = document.getElementById('event-details');
      document.getElementById('event-status').textContent = data.resolved ? 'Resolved' : 'Unresolved';
      document.getElementById('event-name').textContent = data.name;
      document.getElementById('event-start').textContent = data.startTime;
      document.getElementById('event-last-update').textContent = data.lastUpdateTime;
      document.getElementById('event-service').textContent = data.service;

      const timelineElement = document.getElementById('event-description');
      timelineElement.innerHTML = '';
      data.description.forEach((desc) => {
        const timelineItem = document.createElement('div');
        timelineItem.className = 'timeline-item';
        timelineItem.innerHTML = `<p><strong>${desc.time}:</strong> ${desc.detail}</p>`;
        timelineElement.appendChild(timelineItem);
      });

      eventDetailsSection.classList.remove('hidden');
    }

    // Initialize Page
    async function initializePage() {
      const lastUpdatedElement = document.getElementById('last-updated');
      lastUpdatedElement.textContent = new Date().toLocaleString();
      await Promise.all([fetchServiceHistory(), fetchEventList()]);
    }

    // On page load
    document.addEventListener('DOMContentLoaded', initializePage);
  </script>
</body>
</html>
